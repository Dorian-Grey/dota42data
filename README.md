# DOTA2 积分系统

一个用于记录和统计DOTA2比赛数据的积分系统，支持截图OCR识别和手动录入。

## 功能特点

- 📤 **截图上传**: 支持上传小黑盒比赛截图，使用 Gemini AI 自动识别玩家信息
- ✏️ **手动录入**: 当OCR识别不准确时，支持手动录入比赛数据
- 🏆 **积分系统**: 
  - 胜利 +1分
  - 失败 -1分
  - MVP +0.5分
  - SVP +0.5分
  - 僵 -0.5分
- 📊 **数据统计**:
  - 总场次、胜场、负场
  - 胜率统计
  - 称号统计（MVP、SVP、僵）
- 👥 **关系统计**:
  - 作为队友的胜率
  - 作为对手的胜率
- 📈 **积分排行榜**: 实时积分排名
- 📥 **数据导出**: 支持导出Excel文件

## 安装和运行

### 环境要求

- Python 3.8+
- uv (Python包管理器)

### 安装步骤

1. 创建虚拟环境：

```bash
uv venv
```

2. 激活虚拟环境并安装依赖：

```bash
# Windows PowerShell
.venv\Scripts\activate
uv pip install -r requirements.txt

# 或者一行命令
.venv\Scripts\activate; uv pip install flask flask-cors requests pillow pandas openpyxl werkzeug
```

3. 运行应用：

```bash
# 确保已激活虚拟环境
.venv\Scripts\activate; python app.py
```

4. 打开浏览器访问：

```
http://localhost:5000
```

5. 首次使用需要设置 Gemini API Key：
   - 点击右上角 **⚙️ 设置** 按钮
   - 输入你的 Gemini API Key
   - API Key 获取地址：https://aistudio.google.com/apikey

## 使用说明

### 录入比赛

1. **上传截图**（可选）：
   - 点击上传区域或拖拽截图文件
   - 系统会尝试OCR识别玩家信息
   - 识别结果会自动填充到表单

2. **选择获胜方**：
   - 点击"天辉"或"夜魔"按钮

3. **填写玩家信息**：
   - 输入玩家名称
   - 点击选择称号标签（MVP、SVP、僵等）

4. **提交记录**：
   - 点击"提交比赛记录"保存

### 查看积分榜

- 点击导航栏"积分榜"查看排名
- 点击玩家名称查看详细统计

### 查看比赛记录

- 点击导航栏"比赛记录"查看历史比赛
- 可以删除错误的比赛记录

### 导出数据

- 点击导航栏"导出数据"生成Excel文件

## 称号说明

| 称号 | 说明 |
|------|------|
| MVP | 最有价值玩家 |
| SVP | 最无价值玩家（失败不扣分） |
| 僵 | 僵尸 |


## 数据存储

- 比赛数据存储在 `game_data.json` 文件中
- 上传的截图保存在 `uploads/` 目录

## 项目结构

```
dota积分系统/
├── app.py              # Flask主应用
├── database.py         # 数据库操作
├── ocr_parser.py       # Gemini AI图片识别
├── requirements.txt    # Python依赖
├── game_data.json      # 数据存储文件（自动生成）
├── .env                # API Key配置（自动生成）
├── .venv/              # Python虚拟环境
├── static/
│   └── index.html      # 前端页面
├── uploads/            # 截图上传目录
└── README.md           # 说明文档
```

## 技术栈

- **后端**: Python + Flask
- **前端**: HTML + CSS + JavaScript
- **AI识别**: Google Gemini 2.5 Flash
- **数据存储**: JSON文件

## 注意事项

1. AI识别可能不完全准确，请在提交前核对玩家信息
2. 如果识别的阵营错误，可点击"一键交换阵营"按钮
3. 删除比赛记录会重新计算所有玩家的统计数据
4. 建议定期备份 `game_data.json` 文件

玉面飞龙总规则

基础规则：
1、rank模式，任何技能都可选（猴子猴孙，并列，蛛网禁选，以防卡房，科技黑鸟禁选），不可以交换技能池（换池子的扣分，且当局游戏无效）。
2、比赛采用选马模式，赛前各位选手到比赛YY找管理签到，管理按签到先后顺序分配房间，每个房间满10人即开，比赛过程中禁止各位选手私自进入非当局的比赛房间扰乱比赛，视情节扣分或取消比赛资格。
3、每个房间选马一次打两局，第二局天辉夜魇换边，两局打完找管理签到重新分配房间。
每局赛后请各位选手自觉将赛后结算截图发群里，方便管理计分。
 
补充说明：
4、关于选马：每个房间满10人后，按实时积分排名最高的两人roll点选人，点大者先选人后选边或先选边后选人，选人顺序为12221。。
5、关于积分：每局比赛胜方每人+3分，MVP额外+1分，负方每人+0分，SVP额外+1分。 
积分分为（1）赛事模式：打满10局，最后按积分排名。至少打满8局才能上排名。 （2）长期模式：所有比赛均计入长期积分排名，用于马匹分类。
6、关于马匹：打满20场后自动分类为特等前20%，中等60%，自动20%三类，分别价值 1，0，-1。未打满按照公认分类。
7、关于补分：阵容分数不一致，如，5特vs4特+自动，差距2分，失败将弱者阵容每人补偿2分。差距大于等于3分，5特等vs3特+1中等+1自动，差距3分。成绩无效。
 
飞龙杯不仅是一场竞技比拼，更是一个由玩家共同塑造的高质量电竞文化场域。
核心理念：
快乐 Dota：Dota 的魅力在于自由探索与团队协作。我们希望每位选手都能从比赛中获得真正的愉悦，享受竞技带来的热血与成就感。
公平 Dota：公平是赛事的基石。我们致力于提供透明、规范、严谨的规则体系，让每位选手在同等条件下挥洒实力，以技术与智慧决定胜负。
自由 Dota：自由意味着选择的广度与思维的开放。飞龙杯鼓励多样化策略与创造性玩法，解放每位选手的潜力，让更多灵感与可能性得以呈现。
竞技 Dota：竞技不仅是对抗，更是对卓越的追求。我们期望本赛事成为高水平玩家展现自我、相互切磋、共同提升的平台，使竞争成为推动进步的力量。

最终解释权归 Dota2 飞龙在天对黑治理委员会所有。